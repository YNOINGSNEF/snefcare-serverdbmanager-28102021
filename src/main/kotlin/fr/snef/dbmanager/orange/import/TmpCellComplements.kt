package fr.snef.dbmanager.orange.import

import fr.snef.dbmanager.orange.OrangeImportDataFile

class TmpCellComplements(fileNames: List<String>, dumpFolderPath: String) : OrangeImportDataFile(dumpFolderPath) {

    companion object {
        const val complementSuffix = "COMPLEMENT"

        fun from(fileNames: List<String>, dumpFolderPath: String): TmpCellComplements {
            return TmpCellComplements(
                fileNames.filter { it.startsWith(TmpCells.filePrefix) && it.contains(complementSuffix) },
                dumpFolderPath
            )
        }
    }

    override val tableName = "TMP_CELL_COMP"

    override val createTemporaryTableQuery = """
        CREATE TABLE $tableName (
            ID INT AUTO_INCREMENT PRIMARY KEY,
            CELL_IDENTIFIER INT,
            CELL_TYPE VARCHAR(20),
            NETWORK_ELEMENT_ID INT,
            NODE_ID INT,
            DESCRIPTION TEXT,
            BCCH TEXT,
            IS_PREV BOOLEAN NOT NULL
        );
    """

    override val createIndexesQueries = listOf(
        "ALTER TABLE $tableName ADD INDEX index2 (CELL_IDENTIFIER);"
    )

    override val populateTemporaryTableQueries = fileNames.map { fileName ->
        val isPrev = fileName.contains(prevString)
        return@map """
                LOAD DATA LOCAL INFILE '${fullPath(fileName)}'
                INTO TABLE $tableName
                FIELDS TERMINATED BY ';'
                LINES TERMINATED BY '\n'
                IGNORE 1 LINES
                (
                    @CELL_ID,
                    @CELL_TYPE,
                    @NETWORK_ELEMENT_ID,
                    @NODE_ID,
                    @DESCRIPTION,
                    @DISMANTLED,
                    @OPERATION_PURPOSE,
                    @CONTRAINTE_ANFR_000,
                    @COM_DEP,
                    @CLASS_ANT,
                    @REF_CARTE,
                    @PUIS_MAX,
                    @AIR_COMBINING,
                    @FREQUENCY_LIST,
                    @EBLINK_000,
                    @CONFIGURATION_RU_000,
                    @ELIGIBLE_4G_HOME_000,
                    @NB_TRX_INST,
                    @TRX_HP,
                    @DATE_PROV,
                    @ACTIVATION_4RX_D_000,
                    @NB_ANT,
                    @MVSC_000,
                    @VILLE_MVSC_000,
                    @PHASE_MVSC_000,
                    @TGV_000,
                    @TER_000,
                    @METRO_RER_000,
                    @AUTOROUTE_000,
                    @SKI,
                    @BALNEAIRE,
                    @GRAND_PUBLIC,
                    @TRAVAILLEUR,
                    @PERIM_E,
                    @PERIM_2,
                    @COMM_GENE,
                    @COMM_TRAV,
                    @VOL_TRAF,
                    @DEB_EVEN,
                    @CAPT_ROAM,
                    @TGV,
                    @CAP_TRAF_ROAM,
                    @ESSENT,
                    @FIN_EVEN,
                    @TYPOLOGIE_000,
                    @ABS_RF_CHAN_0,
                    @ABS_RF_CHAN_1,
                    @ABS_RF_CHAN_2,
                    @ABS_RF_CHAN_3,
                    @ABS_RF_CHAN_4,
                    @ABS_RF_CHAN_5,
                    @ABS_RF_CHAN_6,
                    @ABS_RF_CHAN_7,
                    @ABS_RF_CHAN_8,
                    @ABS_RF_CHAN_9,
                    @ABS_RF_CHAN_10,
                    @ABS_RF_CHAN_11,
                    @ABS_RF_CHAN_12,
                    @ABS_RF_CHAN_13,
                    @ABS_RF_CHAN_14,
                    @ABS_RF_CHAN_15,
                    @ABS_RF_CHAN_16,
                    @ABS_RF_CHAN_17,
                    @ABS_RF_CHAN_18,
                    @ABS_RF_CHAN_19,
                    @ABS_RF_CHAN_20,
                    @ABS_RF_CHAN_21,
                    @ABS_RF_CHAN_22,
                    @ABS_RF_CHAN_23,
                    @ABS_RF_CHAN_24,
                    @ABS_RF_CHAN_25,
                    @ABS_RF_CHAN_26,
                    @ABS_RF_CHAN_27,
                    @ABS_RF_CHAN_28,
                    @ABS_RF_CHAN_29,
                    @ABS_RF_CHAN_30,
                    @ABS_RF_CHAN_31,
                    @ABS_RF_CHAN_32,
                    @ABS_RF_CHAN_33,
                    @ABS_RF_CHAN_34,
                    @ABS_RF_CHAN_35,
                    @ABS_RF_CHAN_36,
                    @ABS_RF_CHAN_37,
                    @ABS_RF_CHAN_38,
                    @ABS_RF_CHAN_39,
                    @ABS_RF_CHAN_40,
                    @ABS_RF_CHAN_41,
                    @ABS_RF_CHAN_42,
                    @ABS_RF_CHAN_43,
                    @ABS_RF_CHAN_44,
                    @ABS_RF_CHAN_45,
                    @ABS_RF_CHAN_46,
                    @ABS_RF_CHAN_47,
                    @ABS_RF_CHAN_48,
                    @ABS_RF_CHAN_49,
                    @ABS_RF_CHAN_50,
                    @ABS_RF_CHAN_51,
                    @ABS_RF_CHAN_52,
                    @ABS_RF_CHAN_53,
                    @ABS_RF_CHAN_54,
                    @ABS_RF_CHAN_55,
                    @ABS_RF_CHAN_56,
                    @ABS_RF_CHAN_57,
                    @ABS_RF_CHAN_58,
                    @ABS_RF_CHAN_59,
                    @ABS_RF_CHAN_60,
                    @ABS_RF_CHAN_61,
                    @ABS_RF_CHAN_62,
                    @ABS_RF_CHAN_63,
                    @ARFN_SET,
                    @BASE_COLOUR_CODE,
                    @BCCH,
                    @BS_TX_PWR_ATT,
                    @BS_TX_PWR_MAX,
                    @BS_TX_PWR_MAX_IN,
                    @BS_TX_PWR_MIN,
                    @BSIC,
                    @HALF_RATE,
                    @HOPPINGTYPE,
                    @L_RXLEV_UL_H,
                    @L_RXLEV_UL_P,
                    @MAX_PDCH,
                    @MIN_PDCH,
                    @MINNBRGPRSTS,
                    @MS_TX_PWR_MAX,
                    @MS_TX_PWR_MAX_CCH,
                    @MS_TX_PWR_MAX_IN,
                    @MS_TX_PWR_MIN,
                    @NBRSDCCH,
                    @U_RXLEV_UL_P,
                    @DL_ATTEN,
                    @E_HICH_MIN_CODE_POW,
                    @HS_POWER_MARGIN,
                    @HS_SCCH_MAX_CODE_POW,
                    @HS_SCCH_MIN_CODE_POW,
                    @MAX_FACH1_POWER,
                    @MAX_FACH2_POWER,
                    @MAX_POWER_MAX,
                    @MAX_TOTAL_OUT_POW,
                    @MAX_EAGCH_POW_DL,
                    @MAX_EAGCH_POW_DL_TTI2,
                    @MAX_TRANS_POW,
                    @MAX_USER_EH_ER_POW_DL,
                    @MAX_USER_EH_POW_DL_TTI2,
                    @MEAS_POW_OFF,
                    @MIN_PWR_MAX,
                    @PCH_POW,
                    @PICH_POW,
                    @PRIM_CPICH_POW,
                    @PRIM_SCH_POW,
                    @SEC_SCH_POW,
                    @CELL_DL_TOT_POW,
                    @CONF_OUT_POW,
                    @MAX_REF_SIG_POW,
                    @MIN_REF_SIG_POW,
                    @PA_OFF_PDSCH,
                    @PART_SEC_POW,
                    @PBCH_POW_OFF,
                    @PB_OFF_PDSCH,
                    @PCFICH_POW_OFF,
                    @PDCCH_POW_OFF_1,
                    @PDCCH_POW_OFF_2_3,
                    @PHICH_POW_OFF,
                    @PHICH_RES,
                    @PRIM_SYNC_SIG_POW_OFF,
                    @PRS_POW_OFF,
                    @REF_SIG_POW,
                    @SEC_SYNC_SIG_POW_OFF,
                    @BCH_POW,
                    @MAX_NB_SDCCHS,
                    @CHGR_TRX_1,
                    @DCHNO_TRX_1,
                    @FHOP_TRX_1,
                    @FHS_ID_TRX_1,
                    @FREQ_LIST_TRX_1,
                    @FREQUENCY_TRX_1,
                    @HOP_TRX_1,
                    @HOP_SEQ_NB_TRX_1,
                    @MAIO_TRX_1,
                    @CHGR_TRX_2,
                    @DCHNO_TRX_2,
                    @FHOP_TRX_2,
                    @FHS_ID_TRX_2,
                    @FREQ_LIST_TRX_2,
                    @FREQUENCY_TRX_2,
                    @HOP_TRX_2,
                    @HOP_SEQ_NB_TRX_2,
                    @MAIO_TRX_2,
                    @CHGR_TRX_3,
                    @DCHNO_TRX_3,
                    @FHOP_TRX_3,
                    @FHS_ID_TRX_3,
                    @FREQ_LIST_TRX_3,
                    @FREQUENCY_TRX_3,
                    @HOP_TRX_3,
                    @HOP_SEQ_NB_TRX_3,
                    @MAIO_TRX_3,
                    @CHGR_TRX_4,
                    @DCHNO_TRX_4,
                    @FHOP_TRX_4,
                    @FHS_ID_TRX_4,
                    @FREQ_LIST_TRX_4,
                    @FREQUENCY_TRX_4,
                    @HOP_TRX_4,
                    @HOP_SEQ_NB_TRX_4,
                    @MAIO_TRX_4,
                    @CHGR_TRX_5,
                    @DCHNO_TRX_5,
                    @FHOP_TRX_5,
                    @FHS_ID_TRX_5,
                    @FREQ_LIST_TRX_5,
                    @FREQUENCY_TRX_5,
                    @HOP_TRX_5,
                    @HOP_SEQ_NB_TRX_5,
                    @MAIO_TRX_5,
                    @CHGR_TRX_6,
                    @DCHNO_TRX_6,
                    @FHOP_TRX_6,
                    @FHS_ID_TRX_6,
                    @FREQ_LIST_TRX_6,
                    @FREQUENCY_TRX_6,
                    @HOP_TRX_6,
                    @HOP_SEQ_NB_TRX_6,
                    @MAIO_TRX_6,
                    @CHGR_TRX_7,
                    @DCHNO_TRX_7,
                    @FHOP_TRX_7,
                    @FHS_ID_TRX_7,
                    @FREQ_LIST_TRX_7,
                    @FREQUENCY_TRX_7,
                    @HOP_TRX_7,
                    @HOP_SEQ_NB_TRX_7,
                    @MAIO_TRX_7,
                    @CHGR_TRX_8,
                    @DCHNO_TRX_8,
                    @FHOP_TRX_8,
                    @FHS_ID_TRX_8,
                    @FREQ_LIST_TRX_8,
                    @FREQUENCY_TRX_8,
                    @HOP_TRX_8,
                    @HOP_SEQ_NB_TRX_8,
                    @MAIO_TRX_8,
                    @CHGR_TRX_9,
                    @DCHNO_TRX_9,
                    @FHOP_TRX_9,
                    @FHS_ID_TRX_9,
                    @FREQ_LIST_TRX_9,
                    @FREQUENCY_TRX_9,
                    @HOP_TRX_9,
                    @HOP_SEQ_NB_TRX_9,
                    @MAIO_TRX_9,
                    @CHGR_TRX_10,
                    @DCHNO_TRX_10,
                    @FHOP_TRX_10,
                    @FHS_ID_TRX_10,
                    @FREQ_LIST_TRX_10,
                    @FREQUENCY_TRX_10,
                    @HOP_TRX_10,
                    @HOP_SEQ_NB_TRX_10,
                    @MAIO_TRX_10,
                    @CHGR_TRX_11,
                    @DCHNO_TRX_11,
                    @FHOP_TRX_11,
                    @FHS_ID_TRX_11,
                    @FREQ_LIST_TRX_11,
                    @FREQUENCY_TRX_11,
                    @HOP_TRX_11,
                    @HOP_SEQ_NB_TRX_11,
                    @MAIO_TRX_11,
                    @CHGR_TRX_12,
                    @DCHNO_TRX_12,
                    @FHOP_TRX_12,
                    @FHS_ID_TRX_12,
                    @FREQ_LIST_TRX_12,
                    @FREQUENCY_TRX_12,
                    @HOP_TRX_12,
                    @HOP_SEQ_NB_TRX_12,
                    @MAIO_TRX_12,
                    @ELIGIBLE_TRIANGLE,
                    @TRX_HP
                )
                SET
                    CELL_IDENTIFIER = NULLIF(@CELL_ID, ''),
                    CELL_TYPE = NULLIF(@CELL_TYPE, ''),
                    NETWORK_ELEMENT_ID = NULLIF(@NETWORK_ELEMENT_ID, ''),
                    NODE_ID = NULLIF(@NODE_ID, ''),
                    DESCRIPTION = NULLIF(@DESCRIPTION, ''),
                    BCCH = NULLIF(@BCCH, ''),
                    IS_PREV=$isPrev;
            """
    }
}
